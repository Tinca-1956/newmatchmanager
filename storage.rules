rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
  
    // Function to check if the user is an admin (Site or Club)
    function isAdmin() {
      let userRole = get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role;
      return userRole == 'Site Admin' || userRole == 'Club Admin';
    }

    // Rules for match images
    match /matches/{matchId}/{allPaths=**} {
      // Allow reads by anyone (images are public)
      allow read;
      
      // Allow writes (create, update, delete) only by admins
      allow write: if request.auth != null && isAdmin();
    }
  }
}
